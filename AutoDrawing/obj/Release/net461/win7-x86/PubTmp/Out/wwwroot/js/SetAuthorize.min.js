var loading = $("#Loading").hide(); function initialize() { var t = $("#MenuBar"), a = t.find("ol.breadcrumb"), e = $("<li>", { class: "breadcrumb-item active", text: "권한 설정" }); a.append(e); var n = t.find("div.btn-group"), i = $("<div>", { class: "btn-group mr-3", id: "RoleDiv" }); n.before(i); var s = $("<button>", { id: "DetailRole", type: "button", class: "btn btn-light rounded", text: "Role List" }); i.append(s), s.on("click", function () { LoadRoles(), o.fadeIn(), b.fadeIn() }); var o = $("<div>", { class: "card popup", style: "display:none;" }); s.before(o); var r = $("<div>", { class: "row" }); o.append(r); var c = $("<div>", { class: "col" }); r.append(c); var d = $("<div>", { class: "input-group" }); c.append(d); var l = $("<input>", { type: "text", placeholder: "insert role", class: "form-control" }); d.append(l), l.on("keydown", function (t) { 13 === t.keyCode && $(this).siblings().find("button").trigger("click") }); var p = $("<div>", { class: "input-group-append" }); d.append(p); var u = $("<button>", { type: "button", class: "btn btn-light" }); p.append(u), u.on("click", function () { var t = $(this).parent().siblings('input[type="text"]'), a = t.val(); if (isEmpty(a)) return !1; $.ajax({ url: "/Manage/CreateRole", type: "POST", data: { name: a }, success: function () { t.val(""), LoadRoles() }, error: function (t, a, e) { toastr.error(e) } }) }); var v = $("<i>", { class: "fas fa-plus" }); u.append(v); var f = $("<div>", { id: "RoleList" }); o.append(f); var b = $("<div>", { class: "overlay" }); o.before(b), b.on("click", function () { var t = $(this).siblings(".popup"), a = $(this); t.fadeOut(), a.fadeOut() }) } function LoadUserList() { var t = $("#UserList > tbody"); t.empty(), $.getJSON("/Manage/LoadUserList", function (a) { $.each(a, function () { var a = $("<tr>"); t.append(a); for (var e = 0; e < 3; e++) { var n = $("<td>"); a.append(n); var i = this.Id; switch (e) { case 0: var s = $("<span>", { text: this.Email }); n.append(s); break; case 1: var o = this.Roles; $.each(o, function () { var t = $("<button>", { type: "button", value: this, text: this, class: "btn btn-light", "data-userId": i }); n.append(t); var a = $("<i>", { class: "fas fa-times ml-2" }); t.append(a), a.on("click", function () { UnAssignAuthorize($(this).parent().attr("data-userId"), $(this).parent().val()) }) }); break; case 2: n.css("text-align", "right"); var r = $("<button>", { type: "button", class: "btn btn-light font-size-7", value: this.Id }); n.append(r); var c = $("<i>", { class: "fas fa-plus" }); r.append(c), r.on("click", function (t) { $(this).siblings().remove(); var a = $("<div>", { class: "card popup" }); $(this).before(a); var e = $("<div>", { class: "overlay" }); a.before(e), e.on("click", function () { $(this).siblings(".popup").remove(), $(this).remove() }), $.getJSON("/Manage/LoadRoles", function (t) { $.each(t, function () { var t = $("<button>", { type: "button", class: "dropdown-item", value: this, text: this, "data-userId": i }); a.append(t), t.on("click", function () { var t = $(this).val(); AssignAuthorize($(this).attr("data-userId"), t) }) }), a.fadeIn(), e.fadeIn() }) }) } } }) }) } function AssignAuthorize(t, a) { $.ajax({ url: "/Manage/AssignAuthorize", type: "POST", data: { userId: t, roleId: a }, success: function () { LoadUserList() }, error: function (t) { toastr.error(t) } }) } function UnAssignAuthorize(t, a) { $.ajax({ url: "/Manage/UnAssignAuthorize", type: "POST", data: { userId: t, roleId: a }, success: function () { LoadUserList() }, error: function (t) { toastr.error(t) } }) } function LoadRoles() { $.getJSON("/Manage/LoadRoles", function (t) { var a = $("#RoleList"); a.empty(), $.each(t, function () { var t = $("<div>", { class: "row mt-2" }); a.append(t); var e = $("<div>", { class: "col" }); t.append(e); var n = $("<button>", { type: "button", class: "btn btn-light w-100", value: this, text: this }); e.append(n); var i = $("<i>", { class: "fas fa-times ml-2" }); n.append(i), i.on("click", function () { var t = $(this).parent().val(); $.ajax({ url: "/Manage/DeleteRole", type: "POST", data: { id: t }, success: function () { LoadRoles() }, error: function (t, a, e) { toastr.error(e) } }) }) }) }) } $(window).on("load", function () { initialize(), LoadUserList() });